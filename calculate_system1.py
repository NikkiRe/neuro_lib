#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–†–∞—Å—á–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –º–∞—Ä–∫–æ–≤—Å–∫–æ–π –°–ú–û - –°–∏—Å—Ç–µ–º–∞ 1
–í—ã–¥–∞–µ—Ç –≥–æ—Ç–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –æ—Ç—á–µ—Ç–∞
"""

import numpy as np
from numpy.linalg import solve

print("=" * 80)
print("  –†–ê–°–ß–ï–¢ –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö –°–ò–°–¢–ï–ú–´ 1")
print("=" * 80)
print()

# ============================================================================
# –ü–ê–†–ê–ú–ï–¢–†–´
# ============================================================================

print("–ò–°–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:")
print("-" * 80)

LAMBDA = 0.7        # –û–±—â–∏–π –ø–æ—Ç–æ–∫
B = 10.0            # –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
MU = 0.1            # –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

P1 = 0.75          # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–∞ –ü1
P2 = 0.15          # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–∞ –ü2
P3 = 0.10          # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–∞ –ü2 (—Ç–æ–∂–µ!)

print(f"  Œª = {LAMBDA} –∑–∞—è–≤–æ–∫/—Å–µ–∫")
print(f"  b = {B} —Å–µ–∫ (—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è)")
print(f"  Œº = {MU} –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π/—Å–µ–∫")
print()
print(f"  P‚ÇÅ = {P1} (–Ω–∞ –ø—Ä–∏–±–æ—Ä 1)")
print(f"  P‚ÇÇ = {P2} (–Ω–∞ –ø—Ä–∏–±–æ—Ä 2)")
print(f"  P‚ÇÉ = {P3} (–Ω–∞ –ø—Ä–∏–±–æ—Ä 2 —Ç–æ–∂–µ!)")
print()
print("–†–ê–°–ß–ï–¢ –ü–û–¢–û–ö–û–í:")
print(f"  Œª‚ÇÅ = P‚ÇÅ √ó Œª = {P1} √ó {LAMBDA} = {P1 * LAMBDA}")
print(f"  Œª‚ÇÇ = (P‚ÇÇ + P‚ÇÉ) √ó Œª = ({P2} + {P3}) √ó {LAMBDA} = {(P2 + P3) * LAMBDA}")
print()

# –ü–æ—Ç–æ–∫–∏ –Ω–∞ –ø—Ä–∏–±–æ—Ä—ã
LAMBDA_1 = P1 * LAMBDA              # 0.525
LAMBDA_2 = (P2 + P3) * LAMBDA       # 0.175

# ============================================================================
# –ü–û–°–¢–†–û–ï–ù–ò–ï –ú–ê–¢–†–ò–¶–´ –ò –†–ï–®–ï–ù–ò–ï
# ============================================================================

print("–ú–ï–¢–û–î –†–ê–°–ß–ï–¢–ê:")
print("-" * 80)
print("  1. –°—Ç—Ä–æ–∏—Ç—Å—è –º–∞—Ç—Ä–∏—Ü–∞ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–µ–π –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ Q (10√ó10)")
print("  2. –†–µ—à–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ Q^T √ó œÄ = 0 —Å —É—Å–ª–æ–≤–∏–µ–º Œ£œÄ·µ¢ = 1")
print("  3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Ñ–æ—Ä–º—É–ª–∞–º")
print()

print("–°—Ç—Ä–æ–∏–º –º–∞—Ç—Ä–∏—Ü—É –ø–µ—Ä–µ—Ö–æ–¥–æ–≤...")
print()

# –°—Ç—Ä–æ–∏–º –º–∞—Ç—Ä–∏—Ü—É –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
Q = np.zeros((10, 10))

# –°–æ—Å—Ç–æ—è–Ω–∏—è: S0-S9 –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ —Ä–∞–Ω–µ–µ
# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Ç—Ä–∏—Ü—ã –∏–∑ –∑–∞–¥–∞–Ω–∏—è
Q[0, 1] = 0.525;  Q[0, 2] = 0.175
Q[1, 0] = 0.100;  Q[1, 3] = 0.175
Q[2, 0] = 0.100;  Q[2, 3] = 0.525;  Q[2, 4] = 0.175
Q[3, 1] = 0.100;  Q[3, 2] = 0.100;  Q[3, 7] = 0.175
Q[4, 2] = 0.100;  Q[4, 5] = 0.175;  Q[4, 7] = 0.525
Q[5, 4] = 0.100;  Q[5, 6] = 0.175;  Q[5, 8] = 0.525
Q[6, 5] = 0.100;  Q[6, 9] = 0.525
Q[7, 3] = 0.100;  Q[7, 4] = 0.100;  Q[7, 8] = 0.175
Q[8, 5] = 0.100;  Q[8, 7] = 0.100;  Q[8, 9] = 0.175
Q[9, 6] = 0.100;  Q[9, 8] = 0.100

# –î–∏–∞–≥–æ–Ω–∞–ª—å
for i in range(10):
    Q[i, i] = -np.sum(Q[i, :])

# –í—ã–≤–æ–¥–∏–º –º–∞—Ç—Ä–∏—Ü—É
print("–ú–ê–¢–†–ò–¶–ê –ò–ù–¢–ï–ù–°–ò–í–ù–û–°–¢–ï–ô –ü–ï–†–ï–•–û–î–û–í Q:")
print("=" * 110)
print("       ", end="")
for j in range(10):
    print(f"    S{j}    ", end="")
print()
print("-" * 110)

for i in range(10):
    print(f"  S{i}  ", end="")
    for j in range(10):
        print(f" {Q[i, j]:8.5f}", end="")
    print()
print("=" * 110)
print()

# –†–µ—à–∞–µ–º —Å–∏—Å—Ç–µ–º—É
A = Q.T.copy()
A[-1, :] = 1.0
b = np.zeros(10)
b[-1] = 1.0
pi = solve(A, b)

print("–°–¢–ê–¶–ò–û–ù–ê–†–ù–´–ï –í–ï–†–û–Ø–¢–ù–û–°–¢–ò:")
print("-" * 80)
for i in range(10):
    print(f"  p{i} = {pi[i]:.6f}")
print(f"\n  Œ£p·µ¢ = {np.sum(pi):.10f} ‚úì")
print()

# ============================================================================
# –†–ê–°–ß–ï–¢ –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö
# ============================================================================

# –ó–∞–≥—Ä—É–∑–∫–∞ œÅ
rho_1 = pi[1] + pi[3] + pi[6] + pi[8] + pi[9]  # –ü1 –∑–∞–Ω—è—Ç: S1,S3,S6,S8,S9
rho_2 = 1 - (pi[0] + pi[1])                     # –ü2 –∑–∞–Ω—è—Ç: –≤—Å–µ –∫—Ä–æ–º–µ S0,S1
rho_total = (rho_1 + rho_2) / 2.0

# –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å œÄ
pi_1 = rho_1  # –ü1 –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏
pi_2 = pi[7] + pi[9]  # –û—á–µ—Ä–µ–¥—å –ü2 –ø–æ–ª–Ω–∞—è (3 –≤ –æ—á–µ—Ä–µ–¥–∏)
pi_total = P1 * pi_1 + (P2 + P3) * pi_2

# –î–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏ l
l_1 = 0.0
l_2 = 1.0*(pi[4] + pi[6]) + 2.0*(pi[5] + pi[8]) + 3.0*(pi[7] + pi[9])
l_total = l_1 + l_2

# –ß–∏—Å–ª–æ –∑–∞—è–≤–æ–∫ m
m_1 = l_1 + rho_1
m_2 = l_2 + rho_2
m_total = m_1 + m_2

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Œª'
lambda_1_eff = (1.0 - pi_1) * LAMBDA_1
lambda_2_eff = (1.0 - pi_2) * LAMBDA_2
lambda_total_eff = lambda_1_eff + lambda_2_eff

# –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ—è Œ∑
eta_1 = 1.0 - rho_1
eta_2 = 1.0 - rho_2
eta_total = 1.0 - rho_total

# –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è w
w_1 = 0.0
w_2 = l_2 / lambda_2_eff
w_total = l_total / lambda_total_eff

# –í—Ä–µ–º—è –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è u
u_1 = w_1 + B
u_2 = w_2 + B
u_total = w_total + B

# –ù–∞–≥—Ä—É–∑–∫–∞ y
y_1 = LAMBDA_1 * B
y_2 = LAMBDA_2 * B
y_total = y_1 + y_2

# ============================================================================
# –í–´–í–û–î –¢–ê–ë–õ–ò–¶–´
# ============================================================================

print()
print("=" * 80)
print("  –¢–ê–ë–õ–ò–¶–ê 6. –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò –°–ò–°–¢–ï–ú–´ 1")
print("=" * 80)
print()

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
print("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê")
print("‚îÇ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞          ‚îÇ     –ü1       ‚îÇ     –ü2       ‚îÇ   –°–∏—Å—Ç–µ–º–∞    ‚îÇ")
print("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§")

# –î–∞–Ω–Ω—ã–µ
metrics = [
    ("–ù–∞–≥—Ä—É–∑–∫–∞ (y)", y_1, y_2, y_total, ".2f"),
    ("–ó–∞–≥—Ä—É–∑–∫–∞ (œÅ)", rho_1, rho_2, rho_total, ".6f"),
    ("–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å (œÄ)", pi_1, pi_2, pi_total, ".6f"),
    ("–î–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏ (l)", l_1, l_2, l_total, ".6f"),
    ("–ß–∏—Å–ª–æ –∑–∞—è–≤–æ–∫ (m)", m_1, m_2, m_total, ".6f"),
    ("–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (Œª')", lambda_1_eff, lambda_2_eff, lambda_total_eff, ".6f"),
    ("–ö–æ—ç—Ñ. –ø—Ä–æ—Å—Ç–æ—è (Œ∑)", eta_1, eta_2, eta_total, ".6f"),
    ("–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (w)", w_1, w_2, w_total, ".3f"),
    ("–í—Ä–µ–º—è –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è (u)", u_1, u_2, u_total, ".3f"),
]

for name, v1, v2, vtotal, fmt in metrics:
    if fmt == ".2f":
        print(f"‚îÇ {name:23} ‚îÇ {v1:12.2f} ‚îÇ {v2:12.2f} ‚îÇ {vtotal:12.2f} ‚îÇ")
    elif fmt == ".3f":
        print(f"‚îÇ {name:23} ‚îÇ {v1:12.3f} ‚îÇ {v2:12.3f} ‚îÇ {vtotal:12.3f} ‚îÇ")
    else:  # .6f
        print(f"‚îÇ {name:23} ‚îÇ {v1:12.6f} ‚îÇ {v2:12.6f} ‚îÇ {vtotal:12.6f} ‚îÇ")

print("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò")

print()
print("–§–û–†–ú–£–õ–´ –î–õ–Ø –û–¢–ß–ï–¢–ê:")
print("-" * 80)
print()
print("–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–±–æ—Ä–æ–≤:")
print("  œÅ‚ÇÅ = p‚ÇÅ + p‚ÇÉ + p‚ÇÜ + p‚Çà + p‚Çâ  (–ü1 –∑–∞–Ω—è—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö S1,S3,S6,S8,S9)")
print("  œÅ‚ÇÇ = 1 - (p‚ÇÄ + p‚ÇÅ)            (–ü2 –∑–∞–Ω—è—Ç –≤–µ–∑–¥–µ –∫—Ä–æ–º–µ S0,S1)")
print()
print("–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å:")
print("  œÄ‚ÇÅ = œÅ‚ÇÅ                        (–ü1 –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏)")
print("  œÄ‚ÇÇ = p‚Çá + p‚Çâ                   (–æ—á–µ—Ä–µ–¥—å –ü2 –ø–æ–ª–Ω–∞—è - 3 –∑–∞—è–≤–∫–∏)")
print("  œÄ = P‚ÇÅ√óœÄ‚ÇÅ + (P‚ÇÇ+P‚ÇÉ)√óœÄ‚ÇÇ")
print()
print("–î–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏:")
print("  l‚ÇÅ = 0                         (–Ω–µ—Ç –æ—á–µ—Ä–µ–¥–∏ —É –ü1)")
print("  l‚ÇÇ = 1√ó(p‚ÇÑ+p‚ÇÜ) + 2√ó(p‚ÇÖ+p‚Çà) + 3√ó(p‚Çá+p‚Çâ)")
print()
print("–û—Å—Ç–∞–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:")
print("  m = l + œÅ                      (—á–∏—Å–ª–æ –∑–∞—è–≤–æ–∫)")
print("  Œª' = (1-œÄ)√óŒª                   (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)")
print("  Œ∑ = 1 - œÅ                      (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ—è)")
print("  w = l / Œª'                     (–≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è)")
print("  u = w + b                      (–≤—Ä–µ–º—è –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è)")
print("  y = Œª √ó b                      (–Ω–∞–≥—Ä—É–∑–∫–∞)")
print()

print()
print("üéØ –ö–†–ò–¢–ï–†–ò–ô –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò:")
print("-" * 80)
print(f"  –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–µ–π: l = {l_total:.6f}")
print()

print()
print("‚úÖ –†–∞—Å—á–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!")
print()
print("üí° –í–ê–ñ–ù–û:")
print("   P‚ÇÉ = 0.10 —Ç–æ–∂–µ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ü2!")
print("   –ü–æ—ç—Ç–æ–º—É: Œª‚ÇÇ = (P‚ÇÇ + P‚ÇÉ) √ó Œª = (0.15 + 0.10) √ó 0.7 = 0.175")
print()
