#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ะะฐััะตั ัะฐัะฐะบัะตัะธััะธะบ ะผะฐัะบะพะฒัะบะพะน ะกะะ - ะกะธััะตะผะฐ 2
ะะธะฟะตััะบัะฟะพะฝะตะฝัะธะฐะปัะฝะพะต ะพะฑัะปัะถะธะฒะฐะฝะธะต M/H_2.2/1/2
"""

import numpy as np
from numpy.linalg import solve
import math

print("=" * 80)
print("  ะะะกะงะะข ะฅะะะะะขะะะะกะขะะ ะกะะกะขะะะซ 2")
print("  ะะธะฟะตััะบัะฟะพะฝะตะฝัะธะฐะปัะฝะพะต ะพะฑัะปัะถะธะฒะฐะฝะธะต M/H_2.2/1/2")
print("=" * 80)
print()

# ============================================================================
# ะะะะะะะขะะซ
# ============================================================================

print("ะะกะฅะะะะซะ ะะะะะซะ:")
print("-" * 80)

LAMBDA = 0.7        # ะะฑัะธะน ะฟะพัะพะบ
B = 10.0            # ะกัะตะดะฝะตะต ะฒัะตะผั ะพะฑัะปัะถะธะฒะฐะฝะธั
V = 2.2             # ะะพัััะธัะธะตะฝั ะฒะฐัะธะฐัะธะธ
QUEUE_SIZE = 2      # ะะผะบะพััั ะฝะฐะบะพะฟะธัะตะปั

print(f"  ฮป = {LAMBDA} ะทะฐัะฒะพะบ/ัะตะบ (ะธะฝัะตะฝัะธะฒะฝะพััั ะฟะพัะพะบะฐ)")
print(f"  b = {B} ัะตะบ (ััะตะดะฝะตะต ะฒัะตะผั ะพะฑัะปัะถะธะฒะฐะฝะธั)")
print(f"  v = {V} (ะบะพัััะธัะธะตะฝั ะฒะฐัะธะฐัะธะธ)")
print(f"  ะะผะบะพััั ะฝะฐะบะพะฟะธัะตะปั = {QUEUE_SIZE} ะผะตััะฐ")
print()

print("ะะะกะงะะข ะะะะะะะขะะะ ะะะะะะญะะกะะะะะะฆะะะะฌะะะะ ะะะกะะะะะะะะะะฏ:")
print("-" * 80)

# ะัะฑะพั q
q_max = 2.0 / (1.0 + V**2)
print(f"  q โค 2/(1+vยฒ) = {q_max:.4f}")

q = 1.0 / 7.0  # ะะท ะทะฐะดะฐะฝะธั
print(f"  ะัะฑะธัะฐะตะผ: q = 1/7 = {q:.4f}")
print()

# ะะฐััะตั ััะตะดะฝะธั ะฒัะตะผะตะฝ ะพะฑัะปัะถะธะฒะฐะฝะธั ะดะปั ัะฐะท
# bโ' = [1 + โ((1-q)/(2q) ร (vยฒ-1))] ร b
# bโ' = [1 - โ(q/(2(1-q)) ร (vยฒ-1))] ร b

term1 = math.sqrt((1 - q) / (2 * q) * (V**2 - 1))
b1_prime = (1 + term1) * B
mu1 = 1.0 / b1_prime

term2 = math.sqrt(q / (2 * (1 - q)) * (V**2 - 1))
b2_prime = (1 - term2) * B
mu2 = 1.0 / b2_prime

print(f"  bโ' = [1 + โ((1-q)/(2q) ร (vยฒ-1))] ร b")
print(f"      = [1 + โ((1-{q:.4f})/(2ร{q:.4f}) ร ({V}ยฒ-1))] ร {B}")
print(f"      = [1 + {term1:.4f}] ร {B}")
print(f"      = {b1_prime:.2f} ัะตะบ")
print(f"  ฮผโ = 1/bโ' = {mu1:.6f}")
print()

print(f"  bโ' = [1 - โ(q/(2(1-q)) ร (vยฒ-1))] ร b")
print(f"      = [1 - โ({q:.4f}/(2ร{1-q:.4f}) ร ({V}ยฒ-1))] ร {B}")
print(f"      = [1 - {term2:.4f}] ร {B}")
print(f"      = {b2_prime:.2f} ัะตะบ")
print(f"  ฮผโ = 1/bโ' = {mu2:.6f}")
print()

# ะัะพะฒะตัะบะฐ
b_check = q * b1_prime + (1 - q) * b2_prime
print(f"  ะัะพะฒะตัะบะฐ: qรbโ' + (1-q)รbโ' = {q:.4f}ร{b1_prime:.2f} + {1-q:.4f}ร{b2_prime:.2f}")
print(f"                                = {b_check:.2f} = b โ")
print()

# ะะพัะพะบะธ ะฝะฐ ัะฐะทั
lambda1 = q * LAMBDA        # ะะพัะพะบ ะฝะฐ ัะฐะทั 1
lambda2 = (1 - q) * LAMBDA  # ะะพัะพะบ ะฝะฐ ัะฐะทั 2

print("ะะะขะะะ ะะ ะคะะะซ ะะะกะะฃะะะะะะะฏ:")
print(f"  ฮปโ = q ร ฮป = {q:.4f} ร {LAMBDA} = {lambda1:.4f} (ัะฐะทะฐ 1)")
print(f"  ฮปโ = (1-q) ร ฮป = {1-q:.4f} ร {LAMBDA} = {lambda2:.4f} (ัะฐะทะฐ 2)")
print()

# ============================================================================
# ะะะกะขะะะะะะ ะะะขะะะฆะซ ะะะะะฅะะะะ
# ============================================================================

print("ะะะะะะฌ ะกะะกะขะะะซ:")
print("-" * 80)
print("  ะะปะฐััะธัะธะบะฐัะธั ะฟะพ ะะตะฝะดะฐะปะปั: M/Hโ.โ/1/2")
print("  - 1 ะฟัะธะฑะพั")
print("  - 2 ัะฐะทั ะพะฑัะปัะถะธะฒะฐะฝะธั (ะณะธะฟะตััะบัะฟะพะฝะตะฝัะธะฐะปัะฝะพะต)")
print("  - ะะผะบะพััั ะฝะฐะบะพะฟะธัะตะปั: 2 ะผะตััะฐ")
print("  - ะะฐะบัะธะผัะผ ะฒ ัะธััะตะผะต: 3 ะทะฐัะฒะบะธ (1 ะฝะฐ ะพะฑัะปัะถะธะฒะฐะฝะธะธ + 2 ะฒ ะพัะตัะตะดะธ)")
print()

print("ะกะะกะขะะฏะะะฏ ะกะะกะขะะะซ:")
print("-" * 80)
print("  S0: (0, -) - ัะธััะตะผะฐ ะฟัััะฐ")
print("  S1: (1, 1) - 1 ะทะฐัะฒะบะฐ ะฝะฐ ะพะฑัะปัะถะธะฒะฐะฝะธะธ, ัะฐะทะฐ 1")
print("  S2: (1, 2) - 1 ะทะฐัะฒะบะฐ ะฝะฐ ะพะฑัะปัะถะธะฒะฐะฝะธะธ, ัะฐะทะฐ 2")
print("  S3: (2, 1) - 2 ะทะฐัะฒะบะธ (1 ะฒ ะพัะตัะตะดะธ), ัะฐะทะฐ 1")
print("  S4: (2, 2) - 2 ะทะฐัะฒะบะธ (1 ะฒ ะพัะตัะตะดะธ), ัะฐะทะฐ 2")
print("  S5: (3, 1) - 3 ะทะฐัะฒะบะธ (ะพัะตัะตะดั ะฟะพะปะฝะฐ), ัะฐะทะฐ 1")
print("  S6: (3, 2) - 3 ะทะฐัะฒะบะธ (ะพัะตัะตะดั ะฟะพะปะฝะฐ), ัะฐะทะฐ 2")
print()

# ะกััะพะธะผ ะผะฐััะธัั ะฟะตัะตัะพะดะพะฒ (7 ัะพััะพัะฝะธะน)
Q = np.zeros((7, 7))

# S0 -> S1 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ะฝะฐัะธะฝะฐะตััั ัะฐะทะฐ 1)
Q[0, 1] = lambda1
# S0 -> S2 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ะฝะฐัะธะฝะฐะตััั ัะฐะทะฐ 2)
Q[0, 2] = lambda2

# S1 (1 ะทะฐัะฒะบะฐ, ัะฐะทะฐ 1)
# S1 -> S0 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั)
Q[1, 0] = mu1
# S1 -> S3 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ะฟัะพะดะพะปะถะฐะตะผ ัะฐะทั 1)
Q[1, 3] = lambda1
# S1 -> S4 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ัะปะตะดัััะฐั ะฑัะดะตั ัะฐะทะฐ 2)
Q[1, 4] = lambda2

# S2 (1 ะทะฐัะฒะบะฐ, ัะฐะทะฐ 2)
# S2 -> S0 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั)
Q[2, 0] = mu2
# S2 -> S3 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ัะปะตะดัััะฐั ะฑัะดะตั ัะฐะทะฐ 1)
Q[2, 3] = lambda1
# S2 -> S4 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ะฟัะพะดะพะปะถะฐะตะผ ัะฐะทั 2)
Q[2, 4] = lambda2

# S3 (2 ะทะฐัะฒะบะธ, ัะฐะทะฐ 1)
# S3 -> S1 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั, ะฝะฐัะธะฝะฐะตะผ ัะปะตะดััััั ัะฐะทั 1)
Q[3, 1] = mu1 * q
# S3 -> S2 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั, ะฝะฐัะธะฝะฐะตะผ ัะปะตะดััััั ัะฐะทั 2)
Q[3, 2] = mu1 * (1 - q)
# S3 -> S5 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ะพัะตัะตะดั ะทะฐะฟะพะปะฝัะตััั, ัะปะตะดัััะฐั ัะฐะทะฐ 1)
Q[3, 5] = lambda1
# S3 -> S6 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ะพัะตัะตะดั ะทะฐะฟะพะปะฝัะตััั, ัะปะตะดัััะฐั ัะฐะทะฐ 2)
Q[3, 6] = lambda2

# S4 (2 ะทะฐัะฒะบะธ, ัะฐะทะฐ 2)
# S4 -> S1 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั, ะฝะฐัะธะฝะฐะตะผ ัะปะตะดััััั ัะฐะทั 1)
Q[4, 1] = mu2 * q
# S4 -> S2 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั, ะฝะฐัะธะฝะฐะตะผ ัะปะตะดััััั ัะฐะทั 2)
Q[4, 2] = mu2 * (1 - q)
# S4 -> S5 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ะพัะตัะตะดั ะทะฐะฟะพะปะฝัะตััั, ัะปะตะดัััะฐั ัะฐะทะฐ 1)
Q[4, 5] = lambda1
# S4 -> S6 (ะฟัะธะฑััะธะต ะทะฐัะฒะบะธ, ะพัะตัะตะดั ะทะฐะฟะพะปะฝัะตััั, ัะปะตะดัััะฐั ัะฐะทะฐ 2)
Q[4, 6] = lambda2

# S5 (3 ะทะฐัะฒะบะธ, ัะฐะทะฐ 1, ะพัะตัะตะดั ะฟะพะปะฝะฐ)
# S5 -> S3 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั, ะฝะฐัะธะฝะฐะตะผ ัะปะตะดััััั ัะฐะทั 1)
Q[5, 3] = mu1 * q
# S5 -> S4 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั, ะฝะฐัะธะฝะฐะตะผ ัะปะตะดััััั ัะฐะทั 2)
Q[5, 4] = mu1 * (1 - q)
# ะัะธะฑััะธั ัะตัััััั (ะพัะตัะตะดั ะฟะพะปะฝะฐ)

# S6 (3 ะทะฐัะฒะบะธ, ัะฐะทะฐ 2, ะพัะตัะตะดั ะฟะพะปะฝะฐ)
# S6 -> S3 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั, ะฝะฐัะธะฝะฐะตะผ ัะปะตะดััััั ัะฐะทั 1)
Q[6, 3] = mu2 * q
# S6 -> S4 (ะทะฐะฒะตััะตะฝะธะต ะพะฑัะปัะถะธะฒะฐะฝะธั, ะฝะฐัะธะฝะฐะตะผ ัะปะตะดััััั ัะฐะทั 2)
Q[6, 4] = mu2 * (1 - q)
# ะัะธะฑััะธั ัะตัััััั (ะพัะตัะตะดั ะฟะพะปะฝะฐ)

# ะะธะฐะณะพะฝะฐะปั
for i in range(7):
    Q[i, i] = -np.sum(Q[i, :])

# ะัะฒะพะดะธะผ ะผะฐััะธัั
print("ะะะขะะะฆะ ะะะขะะะกะะะะะกะขะะ ะะะะะฅะะะะ Q:")
print("=" * 80)
print("       ", end="")
for j in range(7):
    print(f"    S{j}    ", end="")
print()
print("-" * 80)

for i in range(7):
    print(f"  S{i}  ", end="")
    for j in range(7):
        print(f" {Q[i, j]:8.5f}", end="")
    print()
print("=" * 80)
print()

# ============================================================================
# ะะะจะะะะ ะกะะกะขะะะซ
# ============================================================================

# ะะตัะฐะตะผ ัะธััะตะผั
A = Q.T.copy()
A[-1, :] = 1.0
b = np.zeros(7)
b[-1] = 1.0
pi = solve(A, b)

print("ะกะขะะฆะะะะะะะซะ ะะะะะฏะขะะะกะขะ:")
print("-" * 80)
for i in range(7):
    print(f"  p{i} = {pi[i]:.6f}")
print(f"\n  ฮฃpแตข = {np.sum(pi):.10f} โ")
print()

# ============================================================================
# ะะะกะงะะข ะฅะะะะะขะะะะกะขะะ
# ============================================================================

# ะะฐะณััะทะบะฐ ฯ (ะฒะตัะพััะฝะพััั, ััะพ ะฟัะธะฑะพั ะทะฐะฝัั)
# ะัะธะฑะพั ะทะฐะฝัั ะฒ ัะพััะพัะฝะธัั S1-S6
rho = 1 - pi[0]

# ะะตัะพััะฝะพััั ะฟะพัะตัั ฯ (ะพัะตัะตะดั ะฟะพะปะฝะฐ)
# ะะพัะตัะธ ะฒ ัะพััะพัะฝะธัั S5, S6
pi_loss = pi[5] + pi[6]

# ะะปะธะฝะฐ ะพัะตัะตะดะธ l
# 0 ะฒ ะพัะตัะตะดะธ: S0, S1, S2
# 1 ะฒ ะพัะตัะตะดะธ: S3, S4
# 2 ะฒ ะพัะตัะตะดะธ: S5, S6
l = 1.0 * (pi[3] + pi[4]) + 2.0 * (pi[5] + pi[6])

# ะงะธัะปะพ ะทะฐัะฒะพะบ ะฒ ัะธััะตะผะต m
m = l + rho

# ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ฮป'
lambda_eff = (1.0 - pi_loss) * LAMBDA

# ะะพัััะธัะธะตะฝั ะฟัะพััะพั ฮท
eta = 1.0 - rho

# ะัะตะผั ะพะถะธะดะฐะฝะธั w
w = l / lambda_eff if lambda_eff > 0 else 0

# ะัะตะผั ะฟัะตะฑัะฒะฐะฝะธั u
u = w + B

# ะะฐะณััะทะบะฐ y
y = LAMBDA * B

# ============================================================================
# ะะซะะะ ะขะะะะะฆะซ
# ============================================================================

print()
print("=" * 80)
print("  ะขะะะะะฆะ ะฅะะะะะขะะะะกะขะะ ะกะะกะขะะะซ 2")
print("=" * 80)
print()

print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ")
print("โ ะฅะฐัะฐะบัะตัะธััะธะบะฐ              โ   ะะฝะฐัะตะฝะธะต   โ")
print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโค")
print(f"โ ะะฐะณััะทะบะฐ (y)                โ {y:12.2f} โ")
print(f"โ ะะฐะณััะทะบะฐ (ฯ)                โ {rho:12.6f} โ")
print(f"โ ะะตัะพััะฝะพััั ะฟะพัะตัั (ฯ)      โ {pi_loss:12.6f} โ")
print(f"โ ะะปะธะฝะฐ ะพัะตัะตะดะธ (l)           โ {l:12.6f} โ")
print(f"โ ะงะธัะปะพ ะทะฐัะฒะพะบ (m)            โ {m:12.6f} โ")
print(f"โ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั (ฮป')     โ {lambda_eff:12.6f} โ")
print(f"โ ะะพัั. ะฟัะพััะพั (ฮท)           โ {eta:12.6f} โ")
print(f"โ ะัะตะผั ะพะถะธะดะฐะฝะธั (w)          โ {w:12.3f} โ")
print(f"โ ะัะตะผั ะฟัะตะฑัะฒะฐะฝะธั (u)        โ {u:12.3f} โ")
print("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ")
print()

print("ะคะะะะฃะะซ ะะะฏ ะะขะงะะขะ:")
print("-" * 80)
print()
print("ะะฐะณััะทะบะฐ ะฟัะธะฑะพัะฐ:")
print("  ฯ = 1 - pโ  (ะฟัะธะฑะพั ะทะฐะฝัั ะฒ ัะพััะพัะฝะธัั S1-S6)")
print()
print("ะะตัะพััะฝะพััั ะฟะพัะตัั:")
print("  ฯ = pโ + pโ  (ะพัะตัะตะดั ะฟะพะปะฝะฐั)")
print()
print("ะะปะธะฝะฐ ะพัะตัะตะดะธ:")
print("  l = 1ร(pโ+pโ) + 2ร(pโ+pโ)")
print()
print("ะััะฐะปัะฝัะต ัะฐัะฐะบัะตัะธััะธะบะธ:")
print("  m = l + ฯ         (ัะธัะปะพ ะทะฐัะฒะพะบ)")
print("  ฮป' = (1-ฯ)รฮป      (ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั)")
print("  ฮท = 1 - ฯ         (ะบะพัััะธัะธะตะฝั ะฟัะพััะพั)")
print("  w = l / ฮป'        (ะฒัะตะผั ะพะถะธะดะฐะฝะธั)")
print("  u = w + b         (ะฒัะตะผั ะฟัะตะฑัะฒะฐะฝะธั)")
print("  y = ฮป ร b         (ะฝะฐะณััะทะบะฐ)")
print()

print()
print("๐ฏ ะะะะขะะะะ ะญะคะคะะะขะะะะะกะขะ:")
print("-" * 80)
print(f"  ะะธะฝะธะผะฐะปัะฝะฐั ััะผะผะฐัะฝะฐั ะดะปะธะฝะฐ ะพัะตัะตะดะตะน: l = {l:.6f}")
print()

print()
print("โ ะะฐััะตั ะทะฐะฒะตััะตะฝ!")
print()
print("๐ก ะะกะะะะะะะกะขะ ะกะะกะขะะะซ 2:")
print("   - ะะธะฟะตััะบัะฟะพะฝะตะฝัะธะฐะปัะฝะพะต ะพะฑัะปัะถะธะฒะฐะฝะธะต Hโ.โ")
print("   - ะะฒะต ัะฐะทั ะพะฑัะปัะถะธะฒะฐะฝะธั ั ัะฐะทะฝัะผะธ ะธะฝัะตะฝัะธะฒะฝะพัััะผะธ")
print(f"   - ะคะฐะทะฐ 1: ฮผโ = {mu1:.6f}, ะธัะฟะพะปัะทัะตััั ั ะฒะตัะพััะฝะพัััั q = {q:.4f}")
print(f"   - ะคะฐะทะฐ 2: ฮผโ = {mu2:.6f}, ะธัะฟะพะปัะทัะตััั ั ะฒะตัะพััะฝะพัััั (1-q) = {1-q:.4f}")
print()
