#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Матрица смежности и граф переходов для Системы 1
"""

import numpy as np

print("=" * 100)
print("  ГРАФ ПЕРЕХОДОВ СИСТЕМЫ 1 - ПОЛНЫЙ АНАЛИЗ")
print("=" * 100)
print()

# Параметры
LAMBDA_1 = 0.525
LAMBDA_2 = 0.175
MU = 0.1

# Состояния
states = [
    ("S0", "0/0/0", "Система пуста"),
    ("S1", "1/0/0", "1 заявка на П1"),
    ("S2", "0/1/0", "1 заявка на П2"),
    ("S3", "1/1/0", "П1 и П2 заняты, очередей нет"),
    ("S4", "0/1/1", "П2 занят, 1 в очереди П2"),
    ("S5", "0/1/2", "П2 занят, 2 в очереди П2"),
    ("S6", "1/1/1", "П1 и П2 заняты, 1 в очереди П2"),
    ("S7", "0/1/3", "П2 занят, 3 в очереди П2 (ПОЛНАЯ)"),
    ("S8", "1/1/2", "П1 и П2 заняты, 2 в очереди П2"),
    ("S9", "1/1/3", "П1 и П2 заняты, 3 в очереди П2 (ПОЛНАЯ)"),
]

print("СОСТОЯНИЯ СИСТЕМЫ:")
print("-" * 100)
for name, notation, desc in states:
    print(f"  {name}: {notation:7} - {desc}")
print()

# Строим матрицу переходов (из предоставленной матрицы)
Q = np.zeros((10, 10))

# Заполняем по предоставленной матрице
Q[0, 1] = 0.525;  Q[0, 2] = 0.175
Q[1, 0] = 0.100;  Q[1, 3] = 0.175
Q[2, 0] = 0.100;  Q[2, 3] = 0.525;  Q[2, 4] = 0.175
Q[3, 1] = 0.100;  Q[3, 2] = 0.100;  Q[3, 7] = 0.175
Q[4, 2] = 0.100;  Q[4, 5] = 0.175;  Q[4, 7] = 0.525
Q[5, 4] = 0.100;  Q[5, 6] = 0.175;  Q[5, 8] = 0.525
Q[6, 5] = 0.100;  Q[6, 9] = 0.525
Q[7, 3] = 0.100;  Q[7, 4] = 0.100;  Q[7, 8] = 0.175
Q[8, 5] = 0.100;  Q[8, 7] = 0.100;  Q[8, 9] = 0.175
Q[9, 6] = 0.100;  Q[9, 8] = 0.100

# Диагональ
for i in range(10):
    Q[i, i] = -np.sum(Q[i, :])

# Матрица смежности (показывает только наличие связей, без весов)
A = (Q != 0).astype(int)
# Убираем диагональ
for i in range(10):
    A[i, i] = 0

print("=" * 100)
print("  МАТРИЦА СМЕЖНОСТИ (1 = есть переход, 0 = нет перехода)")
print("=" * 100)
print()
print("      ", end="")
for j in range(10):
    print(f" S{j} ", end="")
print()
print("-" * 100)

for i in range(10):
    print(f"  S{i}  ", end="")
    for j in range(10):
        if A[i, j] == 1:
            print("  ●  ", end="")
        else:
            print("  ·  ", end="")
    print()
print()

# Список всех переходов с интенсивностями
print("=" * 100)
print("  ВСЕ ПЕРЕХОДЫ С ИНТЕНСИВНОСТЯМИ")
print("=" * 100)
print()

transitions = []
for i in range(10):
    for j in range(10):
        if i != j and Q[i, j] > 0:
            transitions.append((i, j, Q[i, j]))

# Группируем по исходному состоянию
for state_from in range(10):
    trans_from = [(j, rate) for i, j, rate in transitions if i == state_from]
    if trans_from:
        print(f"ИЗ {states[state_from][0]} ({states[state_from][1]}) → ")
        for state_to, rate in trans_from:
            print(f"   → {states[state_to][0]} ({states[state_to][1]}): {rate:.3f}")
        print()

# ASCII графика
print("=" * 100)
print("  ГРАФ ПЕРЕХОДОВ (ВИЗУАЛИЗАЦИЯ)")
print("=" * 100)
print()

print("""
                                СИСТЕМА 1: ГРАФ ПЕРЕХОДОВ
                                
                                                         
         ┌───────────────────────────────────────────────────────────────┐
         │                                                               │
         │                           S0 (0/0/0)                         │
         │                        [Система пуста]                        │
         │                                                               │
         └────────────┬────────────────────────┬─────────────────────────┘
                      │                        │
            λ₁=0.525  │                        │ λ₂=0.175
                      ↓                        ↓
         ┌────────────────────────┐  ┌────────────────────────┐
         │   S1 (1/0/0)          │  │   S2 (0/1/0)          │
         │   [1 на П1]           │  │   [1 на П2]           │
         └──────┬────────┬────────┘  └───┬─────────┬─────────┘
                │        │               │         │
         μ=0.1  │        │ λ₂=0.175      │ μ=0.1   │ λ₂=0.175
                ↑        │               ↑         │
         (к S0) │        └───────┐   ┌───┘         │
                │                ↓   ↓             ↓
                │         ┌──────────────────┐  ┌────────────────┐
                │         │  S3 (1/1/0)      │  │  S4 (0/1/1)    │
                │    ┌────│  [Оба заняты]    │  │  [1 в очереди] │
                │    │    └──────┬──┬────────┘  └────┬───────────┘
                │    │           │  │                 │
         λ₁=0.525   │    μ=0.1  │  │ λ₂=0.175  μ=0.1│  λ₁=0.525
         (от S2)    │           │  │                 │
                │    │           │  │                 │
                ↓    ↓           │  ↓                 ↓
         ┌────────────────┐     │  │         ┌──────────────────┐
         │  S7 (0/1/3)    │◄────┘  │    ┌────│  S5 (0/1/2)      │
         │  [Очередь=3]   │        │    │    │  [2 в очереди]   │
         └────┬───────────┘        │    │    └──────┬───────────┘
              │                    │    │           │
       μ=0.1  │ μ=0.1              │    │    μ=0.1 │  λ₁=0.525
              │                    │    │           │
              ↓                    ↓    ↓           ↓
         ┌────────────┐      ┌────────────────┐  ┌────────────────┐
         │  (к S3)    │      │  S6 (1/1/1)    │◄─│  S8 (1/1/2)    │
         │  (к S4)    │      │  [П1,П2,q=1]   │  │  [П1,П2,q=2]   │
         └────────────┘      └────┬───────────┘  └────┬───────────┘
                                  │                   │
                          μ=0.1  │  λ₂=0.525   μ=0.1 │  λ₂=0.175
                          (к S5) │                    │
                                 ↓                    ↓
                            ┌────────────────────────────┐
                            │      S9 (1/1/3)           │
                            │   [П1,П2,очередь=3 ПОЛНА] │
                            └──────┬─────────────┬──────┘
                                   │             │
                            μ=0.1  │             │ μ=0.1
                                   ↓             ↓
                               (к S6)        (к S8)

ОБОЗНАЧЕНИЯ:
  λ₁ = 0.525  - прибытие заявки на прибор П1
  λ₂ = 0.175  - прибытие заявки на прибор П2
  μ  = 0.100  - завершение обслуживания
  
ОСОБЕННОСТИ:
  • П1 БЕЗ ОЧЕРЕДИ - заявки теряются если П1 занят
  • П2 С ОЧЕРЕДЬЮ до 3 заявок - заявки теряются если очередь полна
  • Из состояний S7 и S9 (полная очередь) новые λ₂ заявки теряются
""")

print()
print("=" * 100)
print("  МАТРИЦА ИНТЕНСИВНОСТЕЙ ПЕРЕХОДОВ Q")
print("=" * 100)
print()
print("       ", end="")
for j in range(10):
    print(f"    S{j}    ", end="")
print()
print("-" * 100)

for i in range(10):
    print(f"  S{i}  ", end="")
    for j in range(10):
        if Q[i, j] != 0:
            print(f" {Q[i, j]:8.3f}", end="")
        else:
            print(f"    ·    ", end="")
    print()
print()

# Создаем файл для Graphviz (опционально)
print("=" * 100)
print("  КОД ДЛЯ GRAPHVIZ (сохраните как graph.dot)")
print("=" * 100)
print()

graphviz_code = """digraph System1 {
    rankdir=TB;
    node [shape=circle, style=filled, fillcolor=lightblue];
    
    // Состояния
    S0 [label="S0\\n0/0/0"];
    S1 [label="S1\\n1/0/0"];
    S2 [label="S2\\n0/1/0"];
    S3 [label="S3\\n1/1/0"];
    S4 [label="S4\\n0/1/1"];
    S5 [label="S5\\n0/1/2"];
    S6 [label="S6\\n1/1/1"];
    S7 [label="S7\\n0/1/3", fillcolor=pink];
    S8 [label="S8\\n1/1/2"];
    S9 [label="S9\\n1/1/3", fillcolor=pink];
    
    // Переходы
"""

for i, j, rate in transitions:
    graphviz_code += f'    S{i} -> S{j} [label="{rate:.3f}"];\n'

graphviz_code += "}\n"

print(graphviz_code)

print()
print("=" * 100)
print("  ДЛЯ ВИЗУАЛИЗАЦИИ:")
print("  1. Сохраните код выше в файл graph.dot")
print("  2. Запустите: dot -Tpng graph.dot -o graph.png")
print("  3. Или используйте онлайн: https://dreampuf.github.io/GraphvizOnline/")
print("=" * 100)
print()
