#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–†–∏—Å—É–µ—Ç –≥—Ä–∞—Ñ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –¥–ª—è –°–∏—Å—Ç–µ–º—ã 1 –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Ç—Ä–∏—Ü—ã
"""

try:
    from graphviz import Digraph
    HAS_GRAPHVIZ = True
except ImportError:
    HAS_GRAPHVIZ = False
    print("‚ö†Ô∏è  graphviz –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –†–∏—Å—É—é —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ.")
    print("   –î–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ: pip3 install graphviz")
    print()

import numpy as np

# –ú–∞—Ç—Ä–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏–∑ –∑–∞–¥–∞–Ω–∏—è
Q = np.zeros((10, 10))

# –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ –º–∞—Ç—Ä–∏—Ü–µ –∏–∑ –∑–∞–¥–∞–Ω–∏—è
Q[0, 1] = 0.525;  Q[0, 2] = 0.175
Q[1, 0] = 0.100;  Q[1, 3] = 0.175
Q[2, 0] = 0.100;  Q[2, 3] = 0.525;  Q[2, 4] = 0.175
Q[3, 1] = 0.100;  Q[3, 2] = 0.100;  Q[3, 7] = 0.175
Q[4, 2] = 0.100;  Q[4, 5] = 0.175;  Q[4, 7] = 0.525
Q[5, 4] = 0.100;  Q[5, 6] = 0.175;  Q[5, 8] = 0.525
Q[6, 5] = 0.100;  Q[6, 9] = 0.525
Q[7, 3] = 0.100;  Q[7, 4] = 0.100;  Q[7, 8] = 0.175
Q[8, 5] = 0.100;  Q[8, 7] = 0.100;  Q[8, 9] = 0.175
Q[9, 6] = 0.100;  Q[9, 8] = 0.100

# –î–∏–∞–≥–æ–Ω–∞–ª—å
for i in range(10):
    Q[i, i] = -np.sum(Q[i, :])

# –û–ø–∏—Å–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π
states = {
    0: "0/0/0\n–ø—É—Å—Ç–æ",
    1: "1/0/0\n–ü1 –∑–∞–Ω—è—Ç",
    2: "0/1/0\n–ü2 –∑–∞–Ω—è—Ç",
    3: "1/1/0\n–æ–±–∞ –∑–∞–Ω—è—Ç—ã",
    4: "0/1/1\n–ü2+1 –≤ –æ—á–µ—Ä–µ–¥–∏",
    5: "0/1/2\n–ü2+2 –≤ –æ—á–µ—Ä–µ–¥–∏",
    6: "1/1/1\n–ü1,–ü2+1 –≤ –æ—á.",
    7: "0/1/3\n–ü2+3 (–ø–æ–ª–Ω–∞—è)",
    8: "1/1/2\n–ü1,–ü2+2 –≤ –æ—á.",
    9: "1/1/3\n–ü1,–ü2+3 (–ø–æ–ª–Ω–∞—è)",
}

if HAS_GRAPHVIZ:
    print("=" * 80)
    print("  –°–û–ó–î–ê–ù–ò–ï –ì–†–ê–§–ê –ü–ï–†–ï–•–û–î–û–í –î–õ–Ø –°–ò–°–¢–ï–ú–´ 1")
    print("=" * 80)
    print()
    
    # –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ
    dot = Digraph(comment='–ì—Ä–∞—Ñ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –°–∏—Å—Ç–µ–º—ã 1')
    dot.attr(rankdir='TB')  # –°–≤–µ—Ä—Ö—É –≤–Ω–∏–∑
    dot.attr('node', shape='circle', style='filled', fillcolor='lightblue', 
             fontname='Arial', fontsize='10')
    dot.attr('edge', fontname='Arial', fontsize='9')
    
    # –î–æ–±–∞–≤–ª—è–µ–º —É–∑–ª—ã
    for i in range(10):
        label = f"S{i}\n{states[i]}"
        if i == 0:
            dot.node(f'S{i}', label, fillcolor='lightgreen')  # –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        elif i in [7, 9]:
            dot.node(f'S{i}', label, fillcolor='lightcoral')  # –ü–æ–ª–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        else:
            dot.node(f'S{i}', label)
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Ä—ë–±—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Ç—Ä–∏—Ü—ã Q
    for i in range(10):
        for j in range(10):
            if i != j and Q[i, j] > 0:
                rate = Q[i, j]
                # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞
                if rate == 0.525:
                    label = 'Œª‚ÇÅ=0.525'
                    color = 'blue'
                elif rate == 0.175:
                    label = 'Œª‚ÇÇ=0.175'
                    color = 'red'
                elif rate == 0.100:
                    label = 'Œº=0.1'
                    color = 'green'
                else:
                    label = f'{rate:.3f}'
                    color = 'black'
                
                dot.edge(f'S{i}', f'S{j}', label=label, color=color)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º
    output_file = '/workspace/graph_system1'
    dot.render(output_file, format='png', cleanup=True)
    print(f"‚úÖ –ì—Ä–∞—Ñ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {output_file}.png")
    print()
    
    # –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º DOT —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    with open(f"{output_file}.dot", "w") as f:
        f.write(dot.source)
    print(f"‚úÖ DOT —Ñ–∞–π–ª: {output_file}.dot")
    print()

# –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (–≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º)
print("=" * 80)
print("  –¢–ï–ö–°–¢–û–í–û–ï –ü–†–ï–î–°–¢–ê–í–õ–ï–ù–ò–ï –ì–†–ê–§–ê")
print("=" * 80)
print()

print("–õ–ï–ì–ï–ù–î–ê:")
print("  Œª‚ÇÅ = 0.525 (—Å–∏–Ω–∏–π)  - –ø—Ä–∏–±—ã—Ç–∏–µ –Ω–∞ –ü1")
print("  Œª‚ÇÇ = 0.175 (–∫—Ä–∞—Å–Ω—ã–π) - –ø—Ä–∏–±—ã—Ç–∏–µ –Ω–∞ –ü2")
print("  Œº  = 0.100 (–∑–µ–ª–µ–Ω—ã–π) - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è")
print()

print("–ü–ï–†–ï–•–û–î–´ –ü–û –°–û–°–¢–û–Ø–ù–ò–Ø–ú:")
print("-" * 80)

for i in range(10):
    transitions_out = []
    for j in range(10):
        if i != j and Q[i, j] > 0:
            rate = Q[i, j]
            if rate == 0.525:
                label = 'Œª‚ÇÅ'
            elif rate == 0.175:
                label = 'Œª‚ÇÇ'
            elif rate == 0.100:
                label = 'Œº'
            else:
                label = f'{rate:.3f}'
            transitions_out.append(f"S{j}({label})")
    
    if transitions_out:
        print(f"S{i} [{states[i]:20}] ‚Üí {', '.join(transitions_out)}")
    else:
        print(f"S{i} [{states[i]:20}] ‚Üí (–Ω–µ—Ç –∏—Å—Ö–æ–¥—è—â–∏—Ö)")

print()
print("=" * 80)
print("  –°–¢–†–£–ö–¢–£–†–ê –ì–†–ê–§–ê")
print("=" * 80)
print()

print("""
                    S0 (0/0/0 - –ø—É—Å—Ç–æ)
                   /  \\
              Œª‚ÇÅ  /    \\  Œª‚ÇÇ
                 /      \\
                ‚Üì        ‚Üì
        S1 (1/0/0)    S2 (0/1/0)
        –ü1 –∑–∞–Ω—è—Ç      –ü2 –∑–∞–Ω—è—Ç
           | Œº  \\      / Œª‚ÇÅ | Œº  \\
           ‚Üì     ‚Üò   ‚Üô      ‚Üì     \\  Œª‚ÇÇ
           ‚Üë       S3        ‚Üì       ‚Üì
           |    (1/1/0)      |    S4 (0/1/1)
           | Œº   –æ–±–∞     Œº   |    –ü2+1 –≤ –æ—á.
           |    / \\  \\       |       | Œº  \\
           |   /   \\  \\Œª‚ÇÇ    |       ‚Üì     \\  Œª‚ÇÇ
           |  /     \\  ‚Üò     |       ‚Üë       ‚Üì
           | /       \\   ‚Üò   |       |    S5 (0/1/2)
           |/         \\    S7 ‚Üê------‚îò    –ü2+2 –≤ –æ—á.
           |           \\  (0/1/3)          | Œº  \\
           |            \\ –ü2+3 –ø–æ–ª–Ω.       ‚Üì     \\  Œª‚ÇÅ
           |             \\  ‚Üë Œº   ‚Üë        |       ‚Üì
           |              \\ |     |        |     S6 (1/1/1)
           |               \\|     |        |     –ü1,–ü2+1
           |                ‚Üì     |        |       | Œº  \\
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  S8 ------‚îò        |       ‚Üì     \\  Œª‚ÇÇ
                        (1/1/2)            |       ‚Üë       ‚Üì
                        –ü1,–ü2+2            |       |     S9 (1/1/3)
                          | Œº  \\           ‚îî-------‚îò     –ü1,–ü2+3 –ø–æ–ª–Ω.
                          ‚Üì     ‚Üò Œª‚ÇÇ                      ‚Üë Œº  ‚Üë Œº
                          ‚Üë        ‚Üò                      |    |
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è)  ----‚îò    |
                                                                |
                                                                |

–û–°–û–ë–ï–ù–ù–û–°–¢–ò:
  ‚Ä¢ S0 - –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø—É—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞)
  ‚Ä¢ S7, S9 - —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é (3 –≤ –æ—á–µ—Ä–µ–¥–∏ –ü2)
  ‚Ä¢ –ò–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å –∑–∞–Ω—è—Ç—ã–º –ü1 (S1,S3,S6,S8,S9) –∑–∞—è–≤–∫–∏ Œª‚ÇÅ —Ç–µ—Ä—è—é—Ç—Å—è
  ‚Ä¢ –ò–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–π S7,S9 –∑–∞—è–≤–∫–∏ Œª‚ÇÇ —Ç–µ—Ä—è—é—Ç—Å—è (–æ—á–µ—Ä–µ–¥—å –ø–æ–ª–Ω–∞)
  
–¶–í–ï–¢–û–í–û–ï –ö–û–î–ò–†–û–í–ê–ù–ò–ï (–≤ PNG):
  üü¢ –ó–µ–ª–µ–Ω—ã–π (S0) - –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  üîµ –°–∏–Ω–∏–π - –æ–±—ã—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  üî¥ –ö—Ä–∞—Å–Ω—ã–π (S7, S9) - —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é
""")

print()
print("=" * 80)
print("  –ê–ù–ê–õ–ò–ó –ü–ï–†–ï–•–û–î–û–í")
print("=" * 80)
print()

print("–°–¢–†–ê–ù–ù–´–ï –ü–ï–†–ï–•–û–î–´ (–∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã):")
print("-" * 80)
print()
print("1. S3 ‚Üí S7 (Œª‚ÇÇ=0.175)")
print("   S3 = 1/1/0 (–æ–±–∞ –ø—Ä–∏–±–æ—Ä–∞ –∑–∞–Ω—è—Ç—ã, –æ—á–µ—Ä–µ–¥–µ–π –Ω–µ—Ç)")
print("   S7 = 0/1/3 (–ü1 —Å–≤–æ–±–æ–¥–µ–Ω, –ü2 —Å –ø–æ–ª–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é)")
print("   ‚ö†Ô∏è  –ò–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –∑–∞–Ω—è—Ç—ã–º –ü1 –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º –ü1")
print("      –ø—Ä–∏ –ø—Ä–∏–±—ã—Ç–∏–∏ –∑–∞—è–≤–∫–∏ - —ç—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ!")
print()

print("2. S4 ‚Üí S7 (Œª‚ÇÅ=0.525)")
print("   S4 = 0/1/1 (–ü1 —Å–≤–æ–±–æ–¥–µ–Ω, –ü2 –∑–∞–Ω—è—Ç, 1 –≤ –æ—á–µ—Ä–µ–¥–∏)")
print("   S7 = 0/1/3 (–ü1 —Å–≤–æ–±–æ–¥–µ–Ω, –ü2 –∑–∞–Ω—è—Ç, 3 –≤ –æ—á–µ—Ä–µ–¥–∏)")
print("   ‚ö†Ô∏è  –û–¥–Ω–∞ –∑–∞—è–≤–∫–∞ Œª‚ÇÅ –¥–æ–±–∞–≤–ª—è–µ—Ç 2 –º–µ—Å—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥—å?")
print()

print("–í–û–ó–ú–û–ñ–ù–´–ï –û–ë–™–Ø–°–ù–ï–ù–ò–Ø:")
print("-" * 80)
print("1. –ú–∞—Ç—Ä–∏—Ü–∞ –º–æ–∂–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è")
print("2. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–º–∏")
print("3. –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –¥–æ–ø—É—â–µ–Ω–∏—è–º–∏")
print()

print("–í–´–í–û–î:")
print("-" * 80)
print("–ú–∞—Ç—Ä–∏—Ü–∞ –∏–∑ –∑–∞–¥–∞–Ω–∏—è –†–ê–ë–û–¢–ê–ï–¢ –∏ –¥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.")
print("–ì—Ä–∞—Ñ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–º, –Ω–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.")
print()
